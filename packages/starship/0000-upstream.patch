From 5984f0829ef5369e83c28108378fe0065a617b3c Mon Sep 17 00:00:00 2001
From: David Knaack <davidkna@users.noreply.github.com>
Date: Fri, 19 Aug 2022 08:27:41 +0200
Subject: [PATCH 01/12] perf(git_commit): only use exact match for tag by
 default (#4281)

---
 .github/config-schema.json |  7 +++++++
 docs/config/README.md      | 19 ++++++++++---------
 src/configs/git_commit.rs  |  2 ++
 src/modules/git_commit.rs  | 10 +++++++---
 4 files changed, 26 insertions(+), 12 deletions(-)

diff --git a/.github/config-schema.json b/.github/config-schema.json
index a2e019a7a90..5d0a7c96027 100644
--- a/.github/config-schema.json
+++ b/.github/config-schema.json
@@ -525,6 +525,7 @@
         "only_detached": true,
         "style": "green bold",
         "tag_disabled": true,
+        "tag_max_candidates": 0,
         "tag_symbol": " üè∑  "
       },
       "allOf": [
@@ -2799,6 +2800,12 @@
         "tag_disabled": {
           "default": true,
           "type": "boolean"
+        },
+        "tag_max_candidates": {
+          "default": 0,
+          "type": "integer",
+          "format": "uint",
+          "minimum": 0.0
         }
       }
     },
diff --git a/docs/config/README.md b/docs/config/README.md
index 0267ee1cd5b..ba6ca574c0a 100644
--- a/docs/config/README.md
+++ b/docs/config/README.md
@@ -1558,15 +1558,16 @@ The `git_commit` module shows the current commit hash and also the tag (if any)
 
 ### Options
 
-| Option               | Default                        | Description                                             |
-| -------------------- | ------------------------------ | ------------------------------------------------------- |
-| `commit_hash_length` | `7`                            | The length of the displayed git commit hash.            |
-| `format`             | `"[\\($hash$tag\\)]($style) "` | The format for the module.                              |
-| `style`              | `"bold green"`                 | The style for the module.                               |
-| `only_detached`      | `true`                         | Only show git commit hash when in detached `HEAD` state |
-| `tag_disabled`       | `true`                         | Disables showing tag info in `git_commit` module.       |
-| `tag_symbol`         | `" üè∑ "`                        | Tag symbol prefixing the info shown                     |
-| `disabled`           | `false`                        | Disables the `git_commit` module.                       |
+| Option               | Default                        | Description                                                                          |
+| -------------------- | ------------------------------ | ------------------------------------------------------------------------------------ |
+| `commit_hash_length` | `7`                            | The length of the displayed git commit hash.                                         |
+| `format`             | `"[\\($hash$tag\\)]($style) "` | The format for the module.                                                           |
+| `style`              | `"bold green"`                 | The style for the module.                                                            |
+| `only_detached`      | `true`                         | Only show git commit hash when in detached `HEAD` state                              |
+| `tag_disabled`       | `true`                         | Disables showing tag info in `git_commit` module.                                    |
+| `tag_max_candidates` | `0`                            | How many commits to consider for tag display. The default only allows exact matches. |
+| `tag_symbol`         | `" üè∑ "`                        | Tag symbol prefixing the info shown                                                  |
+| `disabled`           | `false`                        | Disables the `git_commit` module.                                                    |
 
 ### Variables
 
diff --git a/src/configs/git_commit.rs b/src/configs/git_commit.rs
index 12715cb55c9..6b0d3140181 100644
--- a/src/configs/git_commit.rs
+++ b/src/configs/git_commit.rs
@@ -11,6 +11,7 @@ pub struct GitCommitConfig<'a> {
     pub disabled: bool,
     pub tag_symbol: &'a str,
     pub tag_disabled: bool,
+    pub tag_max_candidates: usize,
 }
 
 impl<'a> Default for GitCommitConfig<'a> {
@@ -24,6 +25,7 @@ impl<'a> Default for GitCommitConfig<'a> {
             disabled: false,
             tag_symbol: " üè∑  ",
             tag_disabled: true,
+            tag_max_candidates: 0,
         }
     }
 }
diff --git a/src/modules/git_commit.rs b/src/modules/git_commit.rs
index 88ab069aa11..60f8793ea3d 100644
--- a/src/modules/git_commit.rs
+++ b/src/modules/git_commit.rs
@@ -32,7 +32,7 @@ pub fn module<'a>(context: &'a Context) -> Option<Module<'a>> {
                 "tag" => Some(Ok(format!(
                     "{}{}",
                     config.tag_symbol,
-                    git_tag(context.get_repo().ok()?)?
+                    git_tag(context.get_repo().ok()?, &config)?
                 ))),
                 _ => None,
             })
@@ -50,13 +50,17 @@ pub fn module<'a>(context: &'a Context) -> Option<Module<'a>> {
     Some(module)
 }
 
-fn git_tag(repo: &Repo) -> Option<String> {
+fn git_tag(repo: &Repo, config: &GitCommitConfig) -> Option<String> {
     // allow environment variables like GITOXIDE_OBJECT_CACHE_MEMORY and GITOXIDE_DISABLE_PACK_CACHE to speed up operation for some repos
     let mut git_repo = repo.open().apply_environment();
     git_repo.object_cache_size_if_unset(4 * 1024 * 1024);
     let head_commit = git_repo.head_commit().ok()?;
 
-    let describe_platform = head_commit.describe().names(AnnotatedTags);
+    let describe_platform = head_commit
+        .describe()
+        .names(AnnotatedTags)
+        .max_candidates(config.tag_max_candidates)
+        .traverse_first_parent(true);
     let formatter = describe_platform.try_format().ok()??;
 
     Some(formatter.name?.to_string())

From 24c13e815e6419614e9960b69b16de3d7dbd58fa Mon Sep 17 00:00:00 2001
From: David Knaack <davidkna@users.noreply.github.com>
Date: Fri, 19 Aug 2022 09:04:11 +0200
Subject: [PATCH 02/12] chore: support rust 1.59 again (#4278)

* chore: support rust 1.60 again

* bump shadow-rs
---
 Cargo.lock | 75 +++++-------------------------------------------------
 Cargo.toml |  4 +--
 build.rs   |  3 ++-
 3 files changed, 10 insertions(+), 72 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index fa1962b99c2..d378206f32b 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -414,12 +414,6 @@ dependencies = [
  "cache-padded",
 ]
 
-[[package]]
-name = "const_fn"
-version = "0.4.9"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "fbdcdcb6d86f71c5e97409ad45898af11cbc995b4ee8112d59095a28d376c935"
-
 [[package]]
 name = "const_format"
 version = "0.2.25"
@@ -2032,16 +2026,7 @@ version = "0.8.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "3dfb61232e34fcb633f43d12c58f83c1df82962dcdfa565a4e866ffc17dafe12"
 dependencies = [
- "phf_shared 0.8.0",
-]
-
-[[package]]
-name = "phf"
-version = "0.11.1"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "928c6535de93548188ef63bb7c4036bd415cd8f36ad25af44b9789b2ee72a48c"
-dependencies = [
- "phf_shared 0.11.1",
+ "phf_shared",
 ]
 
 [[package]]
@@ -2051,7 +2036,7 @@ source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "cbffee61585b0411840d3ece935cce9cb6321f01c45477d30066498cd5e1a815"
 dependencies = [
  "phf_generator",
- "phf_shared 0.8.0",
+ "phf_shared",
 ]
 
 [[package]]
@@ -2060,7 +2045,7 @@ version = "0.8.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "17367f0cc86f2d25802b2c26ee58a7b23faeccf78a396094c13dced0d0182526"
 dependencies = [
- "phf_shared 0.8.0",
+ "phf_shared",
  "rand 0.7.3",
 ]
 
@@ -2073,15 +2058,6 @@ dependencies = [
  "siphasher",
 ]
 
-[[package]]
-name = "phf_shared"
-version = "0.11.1"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "e1fb5f6f826b772a8d4c0394209441e7d37cbbb967ae9c7e0e8134365c9ee676"
-dependencies = [
- "siphasher",
-]
-
 [[package]]
 name = "pin-project-lite"
 version = "0.2.9"
@@ -2599,14 +2575,13 @@ dependencies = [
 
 [[package]]
 name = "shadow-rs"
-version = "0.16.2"
+version = "0.16.3"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "1c786b1a738d4c628e9024ca491578a58a7be4594ea4fb67e0cb4c7ad297ae75"
+checksum = "8c0ea0c68418544f725eba5401a5b965a2263254c92458d04aeae74e9d88ff4e"
 dependencies = [
  "const_format",
  "is_debug",
  "time 0.3.11",
- "tzdb",
 ]
 
 [[package]]
@@ -2857,7 +2832,7 @@ dependencies = [
  "dirs 2.0.2",
  "fnv",
  "nom 5.1.2",
- "phf 0.8.0",
+ "phf",
  "phf_codegen",
 ]
 
@@ -3040,28 +3015,6 @@ version = "1.15.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "dcf81ac59edc17cc8697ff311e8f5ef2d99fcbd9817b34cec66f90b6c3dfd987"
 
-[[package]]
-name = "tz-rs"
-version = "0.6.12"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5b3d23fda22515e0e3f4f903e159ad4fd32e37dc94d63522a091df70a247fbb0"
-dependencies = [
- "const_fn",
-]
-
-[[package]]
-name = "tzdb"
-version = "0.4.3"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "fa0c0ce33ad776d606b8109c19bb8b4917185f7b944af9103302f9c4c4fe36ac"
-dependencies = [
- "iana-time-zone",
- "phf 0.11.1",
- "phf_shared 0.11.1",
- "tz-rs",
- "utcnow",
-]
-
 [[package]]
 name = "ucd-trie"
 version = "0.1.3"
@@ -3169,22 +3122,6 @@ version = "2.1.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "68b90931029ab9b034b300b797048cf23723400aa757e8a2bfb9d748102f9821"
 
-[[package]]
-name = "utcnow"
-version = "0.2.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "fe9835442f055fab72d40eb8e5164f2b98e70ebadedbf4506aac23ca7d623053"
-dependencies = [
- "const_fn",
- "errno",
- "js-sys",
- "libc",
- "rustix",
- "wasi 0.11.0+wasi-snapshot-preview1",
- "wasm-bindgen",
- "winapi",
-]
-
 [[package]]
 name = "utf8-width"
 version = "0.1.6"
diff --git a/Cargo.toml b/Cargo.toml
index ad3832a052d..82ae2d5723a 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -66,7 +66,7 @@ semver = "1.0.13"
 serde = { version = "1.0.143", features = ["derive"] }
 serde_json = "1.0.83"
 sha-1 = "0.10.0"
-shadow-rs = { version = "0.16.2", default-features = false }
+shadow-rs = { version = "0.16.3", default-features = false }
 # battery is optional (on by default) because the crate doesn't currently build for Termux
 # see: https://github.com/svartalf/rust-battery/issues/33
 starship-battery = { version = "0.7.9", optional = true }
@@ -110,7 +110,7 @@ features = [
 nix = { version = "0.25.0", default-features = false, features = ["feature", "fs", "user"] }
 
 [build-dependencies]
-shadow-rs = { version = "0.16.2", default-features = false }
+shadow-rs = { version = "0.16.3", default-features = false }
 dunce = "1.0.2"
 
 [target.'cfg(windows)'.build-dependencies]
diff --git a/build.rs b/build.rs
index 7a6753419c0..8e9457e7908 100644
--- a/build.rs
+++ b/build.rs
@@ -38,7 +38,8 @@ fn gen_presets_hook(mut file: &File) -> SdResult<()> {
             format!(
                 r#"
 "{name}" => {{
-        let mut stdout = io::stdout().lock();
+        let stdout = io::stdout();
+        let mut stdout = stdout.lock();
         let _ = stdout.write_all(include_bytes!(r"{full_path}"));
 }}
 "#

From 892604bf4e66d50c16aed4adc844fa3c3ef474d9 Mon Sep 17 00:00:00 2001
From: "dependabot[bot]" <49699333+dependabot[bot]@users.noreply.github.com>
Date: Fri, 19 Aug 2022 09:05:38 +0200
Subject: [PATCH 03/12] build: bump git-repository from 0.21.0 to 0.21.1
 (#4285)

Bumps [git-repository](https://github.com/Byron/gitoxide) from 0.21.0 to 0.21.1.
- [Release notes](https://github.com/Byron/gitoxide/releases)
- [Changelog](https://github.com/Byron/gitoxide/blob/main/CHANGELOG.md)
- [Commits](https://github.com/Byron/gitoxide/compare/git-repository-v0.21.0...git-repository-v0.21.1)

---
updated-dependencies:
- dependency-name: git-repository
  dependency-type: direct:production
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
---
 Cargo.lock | 16 ++++++++--------
 Cargo.toml |  2 +-
 2 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index d378206f32b..98e6e2bfb2a 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -921,9 +921,9 @@ dependencies = [
 
 [[package]]
 name = "git-actor"
-version = "0.11.1"
+version = "0.11.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "48c82fe4f9747e12dba0db1a680720014579c6c25a2859a0e756d9333191fdcd"
+checksum = "9fb53b8b0a098e3db89958c0aa36e1cbaa5e80fdfc98a7535e7078552120cc03"
 dependencies = [
  "bstr",
  "btoi",
@@ -990,9 +990,9 @@ dependencies = [
 
 [[package]]
 name = "git-date"
-version = "0.0.3"
+version = "0.0.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "0ebf74e9db8846a62865c16999d737b803ad9672e5ba46cd81901e0196f63344"
+checksum = "9a2c5b328bf9081b27042a274c895758df97309275e618e4fcfede919ce3d282"
 dependencies = [
  "bstr",
  "itoa",
@@ -1202,9 +1202,9 @@ dependencies = [
 
 [[package]]
 name = "git-repository"
-version = "0.21.0"
+version = "0.21.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "1cd55007ded60d55237cd899475feca98047b141a6805f63e3c2131e581546f6"
+checksum = "09bc3239f9e983ee0bf87a952644bde5b6344219fab54acba959365852b319ea"
 dependencies = [
  "byte-unit",
  "clru",
@@ -1240,9 +1240,9 @@ dependencies = [
 
 [[package]]
 name = "git-revision"
-version = "0.4.0"
+version = "0.4.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "3228b58f157e44051791992d38fb0c502ebf3bc1a10b119b3c9089ef6d84b10e"
+checksum = "66fc0b04b5160de248d4ef2248d41d38dac53388dade1a547dd954dead01c62b"
 dependencies = [
  "bstr",
  "git-date",
diff --git a/Cargo.toml b/Cargo.toml
index 82ae2d5723a..666d3f820cf 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -44,7 +44,7 @@ dunce = "1.0.2"
 gethostname = "0.2.3"
 # Addresses https://github.com/starship/starship/issues/4251
 git-features = { version = "0.22.1", features = ["fs-walkdir-single-threaded"] }
-git-repository = "0.21.0"
+git-repository = "0.21.1"
 indexmap = { version = "1.9.1", features = ["serde"] }
 local_ipaddress = "0.1.3"
 log = { version = "0.4.16", features = ["std"] }

From 627a05862bb8223a524de3f781e9f26bbbbf3088 Mon Sep 17 00:00:00 2001
From: Matan Kushner <hello@matchai.dev>
Date: Thu, 18 Aug 2022 22:50:55 -0400
Subject: [PATCH 04/12] ci: publish to cargo and brew after successful release

---
 .github/workflows/release.yml | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/.github/workflows/release.yml b/.github/workflows/release.yml
index fc84045b132..7d9dcbc3189 100644
--- a/.github/workflows/release.yml
+++ b/.github/workflows/release.yml
@@ -277,7 +277,7 @@ jobs:
   cargo_publish:
     name: Publish Cargo Package
     runs-on: ubuntu-latest
-    needs: release_please
+    needs: [release_please, upload_artifacts]
     if: ${{ needs.release_please.outputs.release_created == 'true' }}
     steps:
       - name: Setup | Checkout
@@ -296,7 +296,7 @@ jobs:
   update_brew_formula:
     name: Update Brew Formula
     runs-on: ubuntu-latest
-    needs: release_please
+    needs: [release_please, upload_artifacts]
     if: ${{ needs.release_please.outputs.release_created == 'true' }}
     steps:
       - uses: mislav/bump-homebrew-formula-action@v2.1

From 97d2de617f0e72694f7f4cb59d99cacb78de356e Mon Sep 17 00:00:00 2001
From: "dependabot[bot]" <49699333+dependabot[bot]@users.noreply.github.com>
Date: Mon, 22 Aug 2022 03:05:46 -0400
Subject: [PATCH 05/12] build: bump serde_json from 1.0.83 to 1.0.85 (#4301)

Bumps [serde_json](https://github.com/serde-rs/json) from 1.0.83 to 1.0.85.
- [Release notes](https://github.com/serde-rs/json/releases)
- [Commits](https://github.com/serde-rs/json/compare/v1.0.83...v1.0.85)

---
updated-dependencies:
- dependency-name: serde_json
  dependency-type: direct:production
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
---
 Cargo.lock | 4 ++--
 Cargo.toml | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index 98e6e2bfb2a..9c55cfc0417 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -2504,9 +2504,9 @@ dependencies = [
 
 [[package]]
 name = "serde_json"
-version = "1.0.83"
+version = "1.0.85"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "38dd04e3c8279e75b31ef29dbdceebfe5ad89f4d0937213c53f7d49d01b3d5a7"
+checksum = "e55a28e3aaef9d5ce0506d0a14dbba8054ddc7e499ef522dd8b26859ec9d4a44"
 dependencies = [
  "itoa",
  "ryu",
diff --git a/Cargo.toml b/Cargo.toml
index 666d3f820cf..34a72129c37 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -64,7 +64,7 @@ regex = "1.6.0"
 rust-ini = "0.18.0"
 semver = "1.0.13"
 serde = { version = "1.0.143", features = ["derive"] }
-serde_json = "1.0.83"
+serde_json = "1.0.85"
 sha-1 = "0.10.0"
 shadow-rs = { version = "0.16.3", default-features = false }
 # battery is optional (on by default) because the crate doesn't currently build for Termux

From 19694ba60ce9ae7ea4ad5faab4987e7b1784ed33 Mon Sep 17 00:00:00 2001
From: "dependabot[bot]" <49699333+dependabot[bot]@users.noreply.github.com>
Date: Mon, 22 Aug 2022 04:06:42 -0400
Subject: [PATCH 06/12] build: bump serde from 1.0.143 to 1.0.144 (#4304)

Bumps [serde](https://github.com/serde-rs/serde) from 1.0.143 to 1.0.144.
- [Release notes](https://github.com/serde-rs/serde/releases)
- [Commits](https://github.com/serde-rs/serde/compare/v1.0.143...v1.0.144)

---
updated-dependencies:
- dependency-name: serde
  dependency-type: direct:production
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
---
 Cargo.lock | 8 ++++----
 Cargo.toml | 2 +-
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index 9c55cfc0417..234bb151611 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -2473,18 +2473,18 @@ dependencies = [
 
 [[package]]
 name = "serde"
-version = "1.0.143"
+version = "1.0.144"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "53e8e5d5b70924f74ff5c6d64d9a5acd91422117c60f48c4e07855238a254553"
+checksum = "0f747710de3dcd43b88c9168773254e809d8ddbdf9653b84e2554ab219f17860"
 dependencies = [
  "serde_derive",
 ]
 
 [[package]]
 name = "serde_derive"
-version = "1.0.143"
+version = "1.0.144"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "d3d8e8de557aee63c26b85b947f5e59b690d0454c753f3adeb5cd7835ab88391"
+checksum = "94ed3a816fb1d101812f83e789f888322c34e291f894f19590dc310963e87a00"
 dependencies = [
  "proc-macro2",
  "quote",
diff --git a/Cargo.toml b/Cargo.toml
index 34a72129c37..871401feccc 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -63,7 +63,7 @@ rayon = "1.5.3"
 regex = "1.6.0"
 rust-ini = "0.18.0"
 semver = "1.0.13"
-serde = { version = "1.0.143", features = ["derive"] }
+serde = { version = "1.0.144", features = ["derive"] }
 serde_json = "1.0.85"
 sha-1 = "0.10.0"
 shadow-rs = { version = "0.16.3", default-features = false }

From 6f29fbfdbc893f40f1b3ca8b3a13a218f6d3a639 Mon Sep 17 00:00:00 2001
From: "dependabot[bot]" <49699333+dependabot[bot]@users.noreply.github.com>
Date: Mon, 22 Aug 2022 12:54:13 +0200
Subject: [PATCH 07/12] build: bump pest_derive from 2.2.1 to 2.3.0 (#4300)

Bumps [pest_derive](https://github.com/pest-parser/pest) from 2.2.1 to 2.3.0.
- [Release notes](https://github.com/pest-parser/pest/releases)
- [Commits](https://github.com/pest-parser/pest/compare/v2.2.1...v2.3.0)

---
updated-dependencies:
- dependency-name: pest_derive
  dependency-type: direct:production
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
---
 Cargo.lock | 16 ++++++++--------
 Cargo.toml |  2 +-
 2 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index 234bb151611..8b0aa487e8a 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -1978,9 +1978,9 @@ checksum = "d4fd5641d01c8f18a23da7b6fe29298ff4b55afcccdf78973b24cf3175fee32e"
 
 [[package]]
 name = "pest"
-version = "2.2.1"
+version = "2.3.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "69486e2b8c2d2aeb9762db7b4e00b0331156393555cff467f4163ff06821eef8"
+checksum = "4b0560d531d1febc25a3c9398a62a71256c0178f2e3443baedd9ad4bb8c9deb4"
 dependencies = [
  "thiserror",
  "ucd-trie",
@@ -1988,9 +1988,9 @@ dependencies = [
 
 [[package]]
 name = "pest_derive"
-version = "2.2.1"
+version = "2.3.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "b13570633aff33c6d22ce47dd566b10a3b9122c2fe9d8e7501895905be532b91"
+checksum = "905708f7f674518498c1f8d644481440f476d39ca6ecae83319bba7c6c12da91"
 dependencies = [
  "pest",
  "pest_generator",
@@ -1998,9 +1998,9 @@ dependencies = [
 
 [[package]]
 name = "pest_generator"
-version = "2.2.1"
+version = "2.3.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "b3c567e5702efdc79fb18859ea74c3eb36e14c43da7b8c1f098a4ed6514ec7a0"
+checksum = "5803d8284a629cc999094ecd630f55e91b561a1d1ba75e233b00ae13b91a69ad"
 dependencies = [
  "pest",
  "pest_meta",
@@ -2011,9 +2011,9 @@ dependencies = [
 
 [[package]]
 name = "pest_meta"
-version = "2.2.1"
+version = "2.3.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5eb32be5ee3bbdafa8c7a18b0a8a8d962b66cfa2ceee4037f49267a50ee821fe"
+checksum = "1538eb784f07615c6d9a8ab061089c6c54a344c5b4301db51990ca1c241e8c04"
 dependencies = [
  "once_cell",
  "pest",
diff --git a/Cargo.toml b/Cargo.toml
index 871401feccc..6894cd77cc0 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -56,7 +56,7 @@ open = "3.0.2"
 os_info = "3.5.0"
 path-slash = "0.2.1"
 pest = "2.2.1"
-pest_derive = "2.2.1"
+pest_derive = "2.3.0"
 quick-xml = "0.23.0"
 rand = "0.8.5"
 rayon = "1.5.3"

From 00598adc080c2a9783eb0abc28a37aa3afcff2b7 Mon Sep 17 00:00:00 2001
From: "dependabot[bot]" <49699333+dependabot[bot]@users.noreply.github.com>
Date: Mon, 22 Aug 2022 13:35:58 +0200
Subject: [PATCH 08/12] build: bump systemstat from 0.1.11 to 0.2.0 (#4302)

Bumps [systemstat](https://github.com/unrelentingtech/systemstat) from 0.1.11 to 0.2.0.
- [Release notes](https://github.com/unrelentingtech/systemstat/releases)
- [Commits](https://github.com/unrelentingtech/systemstat/compare/v0.1.11...v0.2.0)

---
updated-dependencies:
- dependency-name: systemstat
  dependency-type: direct:production
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
---
 Cargo.lock | 6 +++---
 Cargo.toml | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index 8b0aa487e8a..dd1820426b8 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -2778,15 +2778,15 @@ dependencies = [
 
 [[package]]
 name = "systemstat"
-version = "0.1.11"
+version = "0.2.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5f5dc96f7634f46ac7e485b8c051f5b89ec8ee5cc023236dd12fe4ae2fb52f80"
+checksum = "79ef8054a60d76603befaecaf7efe08d32d1a05a1e5df70c547b07507e9e262d"
 dependencies = [
  "bytesize",
- "chrono",
  "lazy_static",
  "libc",
  "nom 7.1.1",
+ "time 0.3.11",
  "winapi",
 ]
 
diff --git a/Cargo.toml b/Cargo.toml
index 6894cd77cc0..4bb072a0b0b 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -71,7 +71,7 @@ shadow-rs = { version = "0.16.3", default-features = false }
 # see: https://github.com/svartalf/rust-battery/issues/33
 starship-battery = { version = "0.7.9", optional = true }
 strsim = "0.10.0"
-systemstat = "=0.1.11"
+systemstat = "=0.2.0"
 terminal_size = "0.2.1"
 toml = { version = "0.5.9", features = ["preserve_order"] }
 toml_edit = "0.14.4"

From f1c93e70e20be78c2db5f1e8dfa1beccf159965f Mon Sep 17 00:00:00 2001
From: shunsambongi <shunsambongi@gmail.com>
Date: Thu, 25 Aug 2022 12:03:24 -0600
Subject: [PATCH 09/12] docs(preset): Add more icons to nerd font preset
 (#4271)

* docs(preset): Add rlang nerd font icon

* docs(preset): Add lua nerd font icon

* docs(preset): Add ruby nerd font icon
---
 .../public/presets/toml/nerd-font-symbols.toml      | 13 +++++++++++--
 1 file changed, 11 insertions(+), 2 deletions(-)

diff --git a/docs/.vuepress/public/presets/toml/nerd-font-symbols.toml b/docs/.vuepress/public/presets/toml/nerd-font-symbols.toml
index 5ad2c7827d4..48e23d9349b 100644
--- a/docs/.vuepress/public/presets/toml/nerd-font-symbols.toml
+++ b/docs/.vuepress/public/presets/toml/nerd-font-symbols.toml
@@ -43,6 +43,9 @@ symbol = "Óâñ "
 [julia]
 symbol = "Óò§ "
 
+[lua]
+symbol = "Óò† "
+
 [memory_usage]
 symbol = "Ô°ö "
 
@@ -61,8 +64,14 @@ symbol = "Ô£ñ "
 [python]
 symbol = "Óàµ "
 
-[spack]
-symbol = "üÖ¢ "
+[rlang]
+symbol = "Ô≥í "
+
+[ruby]
+symbol = "Óûë "
 
 [rust]
 symbol = "Óû® "
+
+[spack]
+symbol = "üÖ¢ "

From 4a1cf14d214f9bf479d7ca4568ecd3a8607a003a Mon Sep 17 00:00:00 2001
From: Patrick Jackson <patrick@jackson.dev>
Date: Thu, 25 Aug 2022 11:11:34 -0700
Subject: [PATCH 10/12] docs(preset): Update nix_shell nerd font icon (#4313)

---
 docs/.vuepress/public/presets/toml/nerd-font-symbols.toml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/docs/.vuepress/public/presets/toml/nerd-font-symbols.toml b/docs/.vuepress/public/presets/toml/nerd-font-symbols.toml
index 48e23d9349b..1c62e0a1426 100644
--- a/docs/.vuepress/public/presets/toml/nerd-font-symbols.toml
+++ b/docs/.vuepress/public/presets/toml/nerd-font-symbols.toml
@@ -53,7 +53,7 @@ symbol = "Ô°ö "
 symbol = "Ôö§ "
 
 [nix_shell]
-symbol = "Ôãú "
+symbol = "Ôåì "
 
 [nodejs]
 symbol = "Óúò "

From db790324a4b198e74208b0129760b2add02734b7 Mon Sep 17 00:00:00 2001
From: "dependabot[bot]" <49699333+dependabot[bot]@users.noreply.github.com>
Date: Thu, 25 Aug 2022 20:11:52 +0200
Subject: [PATCH 11/12] build: bump git-features from 0.22.1 to 0.22.2 (#4311)

Bumps [git-features](https://github.com/Byron/gitoxide) from 0.22.1 to 0.22.2.
- [Release notes](https://github.com/Byron/gitoxide/releases)
- [Changelog](https://github.com/Byron/gitoxide/blob/main/CHANGELOG.md)
- [Commits](https://github.com/Byron/gitoxide/compare/git-features-v0.22.1...git-features-v0.22.2)

---
updated-dependencies:
- dependency-name: git-features
  dependency-type: direct:production
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
---
 Cargo.lock | 8 ++++----
 Cargo.toml | 2 +-
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index dd1820426b8..706e8c70216 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -1026,9 +1026,9 @@ dependencies = [
 
 [[package]]
 name = "git-features"
-version = "0.22.1"
+version = "0.22.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "48289da362ef7ee1412a9a80bb459406d3045ad604484526210d594d10aa5268"
+checksum = "4ed4ee460edb68580e3685a6d20d9c1bd0dabed564667f5273fa8b0871380b64"
 dependencies = [
  "crc32fast",
  "crossbeam-channel",
@@ -1059,9 +1059,9 @@ dependencies = [
 
 [[package]]
 name = "git-hash"
-version = "0.9.7"
+version = "0.9.8"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "898628aaedf437563872461736f861acc1503e23ee4a59857513b0261c014460"
+checksum = "42611c78e4545531ae2078b7599f23dbec4e0f03d42adbe0cfd1189866ea09a5"
 dependencies = [
  "hex",
  "quick-error",
diff --git a/Cargo.toml b/Cargo.toml
index 4bb072a0b0b..663320d58fe 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -43,7 +43,7 @@ dirs-next = "2.0.0"
 dunce = "1.0.2"
 gethostname = "0.2.3"
 # Addresses https://github.com/starship/starship/issues/4251
-git-features = { version = "0.22.1", features = ["fs-walkdir-single-threaded"] }
+git-features = { version = "0.22.2", features = ["fs-walkdir-single-threaded"] }
 git-repository = "0.21.1"
 indexmap = { version = "1.9.1", features = ["serde"] }
 local_ipaddress = "0.1.3"

From dd918296e405e97cf179f66e4ff3e9a430ccb38a Mon Sep 17 00:00:00 2001
From: Sebastian Thiel <sebastian.thiel@icloud.com>
Date: Sat, 27 Aug 2022 20:24:18 +0800
Subject: [PATCH 12/12] build: gitoxide upgrade (#4319)

adjustments to upgrade to gitoxide v0.22.1
---
 Cargo.lock     | 138 +++++++++++++++++++++++++++++--------------------
 Cargo.toml     |   4 +-
 src/context.rs |   2 +-
 3 files changed, 85 insertions(+), 59 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index 706e8c70216..e1325917da2 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -921,9 +921,9 @@ dependencies = [
 
 [[package]]
 name = "git-actor"
-version = "0.11.2"
+version = "0.11.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "9fb53b8b0a098e3db89958c0aa36e1cbaa5e80fdfc98a7535e7078552120cc03"
+checksum = "5f71e800c934ad4cb177a1a396a6ea57e4cb493bd5278d350752205570863478"
 dependencies = [
  "bstr",
  "btoi",
@@ -935,9 +935,9 @@ dependencies = [
 
 [[package]]
 name = "git-attributes"
-version = "0.3.1"
+version = "0.3.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "51845b670130052b90b0938d97d9507c81f3e81f355b232d024729a771293b82"
+checksum = "9fd272a7ccd728534d36965123516057c2d605a9b73454c13e481f0b7c5e3b31"
 dependencies = [
  "bstr",
  "compact_str",
@@ -951,27 +951,27 @@ dependencies = [
 
 [[package]]
 name = "git-bitmap"
-version = "0.1.1"
+version = "0.1.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5442ba44b4385121a333f56837f3e6ce5a1b843d080b93d764578960a510507b"
+checksum = "327098a7ad27ae298d7e71602dbd4375cc828d755d10a720e4be0be1b4ec38f0"
 dependencies = [
  "quick-error",
 ]
 
 [[package]]
 name = "git-chunk"
-version = "0.3.0"
+version = "0.3.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "c915097c009d7870a27ee62dcadbf1410f07cdc6c510efcfb8c1011917bd4f22"
+checksum = "0023a89f84bcc8600556630109edfad1bdeb1820ea8a77306a7ca9c01188ef97"
 dependencies = [
  "quick-error",
 ]
 
 [[package]]
 name = "git-config"
-version = "0.6.1"
+version = "0.7.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "168f2e6bec559afb1e029510ee1746f0971fd35bbd5c20bf43c9df74e32be8f8"
+checksum = "3f873c1aa1d8340ad156181ac425c8bbd696534d94821d5bcd8c576bbfc13856"
 dependencies = [
  "bitflags",
  "bstr",
@@ -990,9 +990,9 @@ dependencies = [
 
 [[package]]
 name = "git-date"
-version = "0.0.4"
+version = "0.1.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "9a2c5b328bf9081b27042a274c895758df97309275e618e4fcfede919ce3d282"
+checksum = "1d58ccaaf783384a6ad68a6abf84942a3f88e34970ced3b34dc68183be50996d"
 dependencies = [
  "bstr",
  "itoa",
@@ -1001,9 +1001,9 @@ dependencies = [
 
 [[package]]
 name = "git-diff"
-version = "0.17.1"
+version = "0.17.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "c7a3d2379658de2bf9b25e730ca8e486d66f1f9515e7f82b1d165f5e0afec742"
+checksum = "3eb6ff7cebb31c3c5285cc887f513509797fd73598ec9b346ace58bdf6597689"
 dependencies = [
  "git-hash",
  "git-object",
@@ -1012,9 +1012,9 @@ dependencies = [
 
 [[package]]
 name = "git-discover"
-version = "0.4.0"
+version = "0.4.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5cf1909f287bd3365dabdbb657f78f02c2ef496001db782f6137588c9668623a"
+checksum = "74e956f5d946471c9edba2781e081340a2147a3046b1f183727aadca3b3df547"
 dependencies = [
  "bstr",
  "git-hash",
@@ -1026,9 +1026,9 @@ dependencies = [
 
 [[package]]
 name = "git-features"
-version = "0.22.2"
+version = "0.22.3"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "4ed4ee460edb68580e3685a6d20d9c1bd0dabed564667f5273fa8b0871380b64"
+checksum = "e1aebbcd709f9a324d3b881801b0e30af616d51ae1a6619b36aee5dc81960131"
 dependencies = [
  "crc32fast",
  "crossbeam-channel",
@@ -1042,16 +1042,16 @@ dependencies = [
  "parking_lot 0.12.1",
  "prodash",
  "quick-error",
- "sha-1",
+ "sha1 0.10.1",
  "sha1_smol",
  "walkdir",
 ]
 
 [[package]]
 name = "git-glob"
-version = "0.3.1"
+version = "0.3.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "8a226a7037e481a312ddba5cc55f6d7aa3eb5043d61e95c289af3632be942f0e"
+checksum = "3d1879e27b5cb57bee828ea57a1ce9a004e9ae51fa71a2d4fb031175386df246"
 dependencies = [
  "bitflags",
  "bstr",
@@ -1069,9 +1069,9 @@ dependencies = [
 
 [[package]]
 name = "git-index"
-version = "0.4.1"
+version = "0.4.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "80691537dd8702a4dc317a1aebc969fae51b0dc995e44e07203cfcb60d49efef"
+checksum = "2032b59abc5b4029498f41373f4567568f835629fe7963bf11c4cf8881a6eab2"
 dependencies = [
  "atoi",
  "bitflags",
@@ -1089,9 +1089,9 @@ dependencies = [
 
 [[package]]
 name = "git-lock"
-version = "2.1.0"
+version = "2.1.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "ee44915b070cde930ecc0e251d53f40d2ad66354546edcfd04720b12e1936e91"
+checksum = "2ff6ad736a93573e219cb9b81c2edb6df0ced812f886e8003df375d96e650e73"
 dependencies = [
  "fastrand",
  "git-tempfile",
@@ -1100,9 +1100,9 @@ dependencies = [
 
 [[package]]
 name = "git-object"
-version = "0.20.1"
+version = "0.20.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "2873d25c73b490aad3897d12f5d1bb9e91404590f37dcf9b72d229972192c07c"
+checksum = "5045f17a3fba3e1668571ec725fd45f948c901bb2562c72ee8e6be7aaa8f7a6f"
 dependencies = [
  "bstr",
  "btoi",
@@ -1119,9 +1119,9 @@ dependencies = [
 
 [[package]]
 name = "git-odb"
-version = "0.31.1"
+version = "0.31.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "e69359d85f7dbbe05984024e63e581092ef38bdf0f12c461077d190fe47b061d"
+checksum = "44578bb80d492d4569eb07426c069f2cc6985af8a3ed9b895f8d8ac6112ab390"
 dependencies = [
  "arc-swap",
  "git-features",
@@ -1137,9 +1137,9 @@ dependencies = [
 
 [[package]]
 name = "git-pack"
-version = "0.21.1"
+version = "0.21.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "89910dcf8ea9befe504e6373832b38c9da49e8dd830206c7f9deae29f1e1d58c"
+checksum = "84efc688a585c627f782c6b1ba06bc8a7450131e4dda240386bff1ee705e009f"
 dependencies = [
  "bytesize",
  "clru",
@@ -1162,9 +1162,9 @@ dependencies = [
 
 [[package]]
 name = "git-path"
-version = "0.4.0"
+version = "0.4.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "6f054752f9f73d557f4ef0a4e48f2f7e01454abd7accdef9f85f0ef4fa2c6e8f"
+checksum = "eb95b96097d742975f700c6a125ab447b051787eec322e3f6e59e83c867dea40"
 dependencies = [
  "bstr",
  "thiserror",
@@ -1172,9 +1172,9 @@ dependencies = [
 
 [[package]]
 name = "git-quote"
-version = "0.2.0"
+version = "0.2.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "8ec1960fa4f68a1637ce03d8c151ae2f8565d1de119a3eee8b5b9a364a08aacb"
+checksum = "38e200d7357e12e0676cd3348176665f90f9a6139caa87ca49a19a6dd6e996cf"
 dependencies = [
  "bstr",
  "btoi",
@@ -1183,9 +1183,9 @@ dependencies = [
 
 [[package]]
 name = "git-ref"
-version = "0.15.1"
+version = "0.15.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "95c37be789a743f28b1430c9d6096fa637eb696746ae88b76c4b96112e802c8f"
+checksum = "97982aefe48e8ff0c9e0c3bb2c9f9388c9653072fa8706aaa87ac8c90e2dfa4a"
 dependencies = [
  "git-actor",
  "git-features",
@@ -1200,11 +1200,25 @@ dependencies = [
  "quick-error",
 ]
 
+[[package]]
+name = "git-refspec"
+version = "0.1.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "32886438939729151852fb2379007a3f17695232cdc65a81c7e757ae4b587b71"
+dependencies = [
+ "bstr",
+ "git-hash",
+ "git-revision",
+ "git-validate",
+ "smallvec",
+ "thiserror",
+]
+
 [[package]]
 name = "git-repository"
-version = "0.21.1"
+version = "0.22.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "09bc3239f9e983ee0bf87a952644bde5b6344219fab54acba959365852b319ea"
+checksum = "13a607977b24ff29831297c80ae3b24bd45b04f81f3ca3047744453d6ae6e920"
 dependencies = [
  "byte-unit",
  "clru",
@@ -1224,6 +1238,7 @@ dependencies = [
  "git-pack",
  "git-path",
  "git-ref",
+ "git-refspec",
  "git-revision",
  "git-sec",
  "git-tempfile",
@@ -1240,9 +1255,9 @@ dependencies = [
 
 [[package]]
 name = "git-revision"
-version = "0.4.1"
+version = "0.4.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "66fc0b04b5160de248d4ef2248d41d38dac53388dade1a547dd954dead01c62b"
+checksum = "1877eb33a9caf9cbb5438d9358ebaf16b858f0e4f502b1c07bf0b1c512b90922"
 dependencies = [
  "bstr",
  "git-date",
@@ -1254,9 +1269,9 @@ dependencies = [
 
 [[package]]
 name = "git-sec"
-version = "0.3.0"
+version = "0.3.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "ffcecb38973b7c8fb3be5ae855a366a1e615fe1b7cf38d217f3e1adeb3608170"
+checksum = "0073a138d171b64d5251726620c2232f695f7fbcfa7e5678dc62c1c19846f0e5"
 dependencies = [
  "bitflags",
  "dirs 4.0.0",
@@ -1268,9 +1283,9 @@ dependencies = [
 
 [[package]]
 name = "git-tempfile"
-version = "2.0.2"
+version = "2.0.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "4c1d7753a96a332e404d6f985caa41bcbd6f08a8e40b4f452dd5e3985d4c4e8e"
+checksum = "baed392d47397d32d29be06bc09824a259a44df85614fd301ef98e69770a15b9"
 dependencies = [
  "dashmap",
  "libc",
@@ -1282,9 +1297,9 @@ dependencies = [
 
 [[package]]
 name = "git-traverse"
-version = "0.16.1"
+version = "0.16.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "c89b9468cd57d145b8bc06f1a8e867b8ed5044c3f856cc7b98a9aac97f9163aa"
+checksum = "5edc8f220eb957d4ddba19bf42dca323a3e584d067634946a3bf30cca4383052"
 dependencies = [
  "git-hash",
  "git-object",
@@ -1294,23 +1309,23 @@ dependencies = [
 
 [[package]]
 name = "git-url"
-version = "0.7.1"
+version = "0.7.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "7efc31fd6bb3a52a18006dfaf686e3ba4d0d7ad0ca325bfc7d719affd28dc624"
+checksum = "e7805eb7dddaf2d4097495e7bee7611385a7d9ac7b5991e11500e616f559e4af"
 dependencies = [
  "bstr",
  "git-features",
  "git-path",
  "home",
- "quick-error",
+ "thiserror",
  "url",
 ]
 
 [[package]]
 name = "git-validate"
-version = "0.5.4"
+version = "0.5.5"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "2c2c1eaaa942eb3c49ab20f27c0715e79e26e6b156a0f77d7ed7bbb26126a8fa"
+checksum = "7af1453adfe6011f0ef71824591b7cdd85850c27bbf3dc8fa855574bed2fe107"
 dependencies = [
  "bstr",
  "quick-error",
@@ -1318,9 +1333,9 @@ dependencies = [
 
 [[package]]
 name = "git-worktree"
-version = "0.4.1"
+version = "0.4.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "779a6a2a0d51b690fdf1e0024138a2f320be89db7fc2e7f5becd20e65aa42344"
+checksum = "5f4f5175b6a78a8689d86d9e53ac767f69a8472a6c4b20f8d16fd9a0bf84ba3a"
 dependencies = [
  "bstr",
  "git-attributes",
@@ -2533,7 +2548,6 @@ dependencies = [
  "cfg-if 1.0.0",
  "cpufeatures",
  "digest 0.10.3",
- "sha1-asm",
 ]
 
 [[package]]
@@ -2545,6 +2559,18 @@ dependencies = [
  "sha1_smol",
 ]
 
+[[package]]
+name = "sha1"
+version = "0.10.1"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "c77f4e7f65455545c2153c1253d25056825e77ee2533f0e41deb65a93a34852f"
+dependencies = [
+ "cfg-if 1.0.0",
+ "cpufeatures",
+ "digest 0.10.3",
+ "sha1-asm",
+]
+
 [[package]]
 name = "sha1-asm"
 version = "0.5.1"
@@ -3535,7 +3561,7 @@ dependencies = [
  "rand 0.8.5",
  "serde",
  "serde_repr",
- "sha1",
+ "sha1 0.6.1",
  "static_assertions",
  "tracing",
  "uds_windows",
diff --git a/Cargo.toml b/Cargo.toml
index 663320d58fe..8adda07f173 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -43,8 +43,8 @@ dirs-next = "2.0.0"
 dunce = "1.0.2"
 gethostname = "0.2.3"
 # Addresses https://github.com/starship/starship/issues/4251
-git-features = { version = "0.22.2", features = ["fs-walkdir-single-threaded"] }
-git-repository = "0.21.1"
+git-features = { version = "0.22.3", features = ["fs-walkdir-single-threaded"] }
+git-repository = "0.22.1"
 indexmap = { version = "1.9.1", features = ["serde"] }
 local_ipaddress = "0.1.3"
 log = { version = "0.4.16", features = ["std"] }
diff --git a/src/context.rs b/src/context.rs
index ac089e7ea5f..d47502bb89a 100644
--- a/src/context.rs
+++ b/src/context.rs
@@ -629,7 +629,7 @@ fn get_remote_repository_info(
 ) -> Option<Remote> {
     let branch_name = branch_name?;
     let branch = repository
-        .remote_ref(branch_name)
+        .branch_remote_ref(branch_name)
         .and_then(|r| r.ok())
         .map(|r| r.shorten().to_string());
     let name = repository
